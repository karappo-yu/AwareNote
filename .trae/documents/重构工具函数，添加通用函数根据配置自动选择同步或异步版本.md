# 重构工具函数，添加通用函数根据配置自动选择同步或异步版本

## 1. 重构 image_utils.py

### 1.1 添加通用函数
- `generate_cover(book)`: 根据配置自动选择同步或异步版本
- `generate_thumbnail(book, page_number, thumbnail_width)`: 根据配置自动选择同步或异步版本

### 1.2 函数实现逻辑
- 检查配置中的 `use_process_pool` 设置
- 如果开启线程池，调用异步版本 `generate_cover_async` 或 `generate_thumbnail_async`
- 如果未开启线程池，调用同步版本 `generate_cover_sync` 或 `generate_thumbnail_sync`

### 1.3 重命名现有函数
- 将现有的 `generate_cover` 重命名为 `generate_cover_sync`
- 将现有的 `generate_thumbnail` 重命名为 `generate_thumbnail_sync`

## 2. 重构 pdf_utils.py

### 2.1 添加通用函数
- `get_pdf_page_svg(pdf_path, book_id, page_num)`: 根据配置自动选择同步或异步版本

### 2.2 函数实现逻辑
- 检查配置中的 `use_process_pool` 设置
- 如果开启线程池，调用异步版本 `get_pdf_page_svg_async`
- 如果未开启线程池，调用同步版本 `get_pdf_page_svg_sync`

### 2.3 重命名现有函数
- 将现有的 `get_pdf_page_svg` 重命名为 `get_pdf_page_svg_sync`

## 3. 修改调用这些函数的地方

### 3.1 修改 book.py API
- 使用新的通用函数 `generate_cover` 和 `generate_thumbnail`
- 确保 API 端点能够正确处理异步调用

### 3.2 修改其他可能的调用点
- 检查代码库中其他调用这些函数的地方，确保使用新的通用函数

## 4. 确保配置加载
- 确保在工具函数中正确加载配置，特别是 `use_process_pool` 设置
- 从 `config.config` 导入 `get` 函数来获取配置值

## 5. 测试
- 测试线程池开启和关闭两种情况下的功能
- 确保所有 API 端点都能正常工作
- 确保缩略图和封面生成功能正常
- 确保 PDF SVG 生成功能正常